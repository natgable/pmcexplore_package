<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Natalie Gable" />

<meta name="date" content="2020-08-17" />

<title>pmcexplore</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">pmcexplore</h1>
<h4 class="author">Natalie Gable</h4>
<h4 class="date">2020-08-17</h4>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co">#&gt; -- Attaching packages -------------------------------------------- tidyverse 1.3.0 --</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">#&gt; v ggplot2 3.3.1     v purrr   0.3.4</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">#&gt; v tibble  3.0.3     v dplyr   1.0.1</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; v tidyr   1.1.1     v stringr 1.4.0</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; v readr   1.3.1     v forcats 0.5.0</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; -- Conflicts ----------------------------------------------- tidyverse_conflicts() --</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt; x dplyr::filter() masks stats::filter()</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="kw">library</span>(pmcexplore)</a></code></pre></div>
<div id="introduction-and-overview-to-pmcexplore" class="section level1">
<h1>Introduction and Overview to pmcexplore</h1>
<p><code>pmcexplore</code> allows users to search PubMed Central (PMC), pull text data, and wrangle data for modeling tasks.</p>
<p>To use functions in <code>pmcexplore</code>, navigate to the directory where the package folder is using <code>setwd(&quot;path to directory here&quot;)</code>. Then run <code>install(&quot;pmcexplore&quot;)</code> and <code>library(pmcexplore)</code>. You can access this document by <code>vignette(pmcexplore)</code>.</p>
<p><code>pmcexplore</code> provides functions to handle text data from sourcing to modeling and relies on the NCBI E-utilities API to pull full-text XML documents from the database.</p>
<p>A full list of functions in the <code>pmcexplore</code> package is included below. Information about any of these functions and how to use them can be accessed by running <code>?pmcexplore::function_name</code>.</p>
<p><strong>Available Functions</strong></p>
<ul>
<li><code>clean_DAS</code></li>
<li><code>convert_id</code></li>
<li><code>generate_features</code></li>
<li><code>get_abstract</code></li>
<li><code>get_DAS</code></li>
<li><code>get_funding</code></li>
<li><code>get_mesh</code></li>
<li><code>get_references</code></li>
<li><code>label_DAS</code></li>
<li><code>preprocess_text</code></li>
<li><code>search_by_date</code></li>
<li><code>search_by_mesh</code></li>
<li><code>search_keyword</code></li>
<li><code>tidy_metadata</code></li>
<li><code>xml_by_id</code></li>
</ul>
<p>The general workflow using <code>pmcexplore</code> is described below.</p>
<p>First, we’ll start by getting the ID numbers of the documents we’d like to look at. The package includes three functions to search PMC.</p>
<table>
<colgroup>
<col width="17%"></col>
<col width="82%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>search_by_date</code></td>
<td align="left">Get ID numbers of papers published in PMC between input start and end dates.</td>
</tr>
<tr class="even">
<td align="left"><code>search_keyword</code></td>
<td align="left">Get ID numbers of papers associated with input keyword(s).</td>
</tr>
<tr class="odd">
<td align="left"><code>search_by_mesh</code></td>
<td align="left">Get ID numbers of papers that are tagged with input MeSH terms.</td>
</tr>
</tbody>
</table>
<p>In practice, this will look something like:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">my_ids &lt;-<span class="st"> </span><span class="kw">search_by_date</span>(<span class="dt">start =</span> <span class="st">&quot;2019/01/01&quot;</span>, <span class="dt">end =</span> <span class="st">&quot;2019/01/02&quot;</span>)</a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">head</span>(my_ids)</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">#&gt; # A tibble: 6 x 1</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">#&gt;   PMCID     </span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">#&gt;   &lt;chr&gt;     </span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">#&gt; 1 PMC6302599</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">#&gt; 2 PMC6302597</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">#&gt; 3 PMC6302590</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">#&gt; 4 PMC6302578</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co">#&gt; 5 PMC6302575</span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="co">#&gt; 6 PMC6302572</span></a></code></pre></div>
<p>This will get me all the IDs of papers published in PMC between January 1 and January 2 2019.</p>
<p>Next, we can retrieve the full-text XML associated with each ID number. This involves using the <code>purrr</code> package (included in the <code>tidyverse</code>), which provides functions to apply processes iteratively, over multiple inputs. The result of this process will give us a tibble (dataframe) with two columns, PMCID and text. The PMCID column gives the PMCIDs (as strings) and the text column is actually an embedded tibble containing the text information, as parsed by <code>tidypmc::pmc_text</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">my_text &lt;-</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="st">  </span>my_ids <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="st">  </span><span class="kw">pull</span>(PMCID) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># this takes out just the character vector</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="st">  </span><span class="kw">map</span>(xml_by_id) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># the map function applies pmcexplore::xml_by_id to retrieve xmls for each ID number</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="st">  </span><span class="kw">tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># wrangle into a tibble datatype</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">xml =</span> <span class="st">&quot;.&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="st">  </span><span class="kw">transmute</span>(</a>
<a class="sourceLine" id="cb3-8" title="8">    <span class="dt">PMCID =</span> my_ids <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(PMCID),</a>
<a class="sourceLine" id="cb3-9" title="9">    <span class="dt">text =</span> <span class="kw">map</span>(xml, tidypmc<span class="op">::</span>pmc_text) <span class="co"># uses the tidypmc function to parse text</span></a>
<a class="sourceLine" id="cb3-10" title="10">  )</a>
<a class="sourceLine" id="cb3-11" title="11"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-12" title="12"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-15" title="15"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-16" title="16"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-17" title="17"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-18" title="18"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-19" title="19"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-20" title="20"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-21" title="21"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-22" title="22"><span class="co">#&gt; Missing 2 title in sec/p tag</span></a>
<a class="sourceLine" id="cb3-23" title="23"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-24" title="24"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-25" title="25"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-26" title="26"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-27" title="27"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-28" title="28"><span class="co">#&gt; Adding brackets to numbered references in /sup tags</span></a>
<a class="sourceLine" id="cb3-29" title="29"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-30" title="30"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-31" title="31"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-32" title="32"><span class="co">#&gt; Note: removing disp-formula nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-33" title="33"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-34" title="34"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-35" title="35"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-36" title="36"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-37" title="37"><span class="co">#&gt; Note: removing disp-formula nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-38" title="38"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-39" title="39"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-40" title="40"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-41" title="41"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-42" title="42"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-43" title="43"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-44" title="44"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-45" title="45"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-46" title="46"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-47" title="47"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-48" title="48"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-49" title="49"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-50" title="50"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-51" title="51"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-52" title="52"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-53" title="53"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-54" title="54"><span class="co">#&gt; Note: removing disp-formula nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-55" title="55"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-56" title="56"><span class="co">#&gt; Note: removing disp-formula nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-57" title="57"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-58" title="58"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-59" title="59"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-60" title="60"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-61" title="61"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-62" title="62"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-63" title="63"><span class="co">#&gt; Note: removing disp-formula nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-64" title="64"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-65" title="65"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-66" title="66"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-67" title="67"><span class="co">#&gt; Note: removing disp-formula nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-68" title="68"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-69" title="69"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-70" title="70"><span class="co">#&gt; Note: removing disp-formula nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-71" title="71"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-72" title="72"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-73" title="73"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-74" title="74"><span class="co">#&gt; Note: removing disp-formula nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-75" title="75"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-76" title="76"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-77" title="77"><span class="co">#&gt; Note: removing disp-formula nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-78" title="78"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-79" title="79"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-80" title="80"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-81" title="81"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-82" title="82"><span class="co">#&gt; Note: removing disp-formula nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-83" title="83"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-84" title="84"><span class="co">#&gt; Note: removing disp-formula nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-85" title="85"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-86" title="86"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-87" title="87"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-88" title="88"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-89" title="89"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-90" title="90"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-91" title="91"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-92" title="92"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-93" title="93"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-94" title="94"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-95" title="95"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-96" title="96"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-97" title="97"><span class="co">#&gt; Note: removing disp-formula nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-98" title="98"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-99" title="99"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: No sections found, using all text in main body/p</span></a>
<a class="sourceLine" id="cb3-100" title="100"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-101" title="101"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-102" title="102"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-103" title="103"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-104" title="104"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-105" title="105"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-106" title="106"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: No sections found, using all text in main body/p</span></a>
<a class="sourceLine" id="cb3-107" title="107"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-108" title="108"><span class="co">#&gt; Adding brackets to numbered references in /sup tags</span></a>
<a class="sourceLine" id="cb3-109" title="109"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-110" title="110"><span class="co">#&gt; Adding brackets to numbered references in /sup tags</span></a>
<a class="sourceLine" id="cb3-111" title="111"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-112" title="112"><span class="co">#&gt; Adding brackets to numbered references in /sup tags</span></a>
<a class="sourceLine" id="cb3-113" title="113"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-114" title="114"><span class="co">#&gt; Adding brackets to numbered references in /sup tags</span></a>
<a class="sourceLine" id="cb3-115" title="115"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-116" title="116"><span class="co">#&gt; Note: removing table-wrap nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-117" title="117"><span class="co">#&gt; Note: removing fig nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-118" title="118"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-119" title="119"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-120" title="120"><span class="co">#&gt; Note: removing disp-formula nested in sec/p tag</span></a>
<a class="sourceLine" id="cb3-121" title="121"><span class="co">#&gt; Adding brackets to numbered references in /sup tags</span></a>
<a class="sourceLine" id="cb3-122" title="122"><span class="co">#&gt; Adding brackets to numbered references in /sup tags</span></a>
<a class="sourceLine" id="cb3-123" title="123"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: No sections found, using all text in main body/p</span></a>
<a class="sourceLine" id="cb3-124" title="124"><span class="co">#&gt; Adding brackets to numbered references in /sup tags</span></a>
<a class="sourceLine" id="cb3-125" title="125"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Body has both /p and /sec tags - untitled Introduction?</span></a>
<a class="sourceLine" id="cb3-126" title="126"></a>
<a class="sourceLine" id="cb3-127" title="127"><span class="kw">head</span>(my_text)</a>
<a class="sourceLine" id="cb3-128" title="128"><span class="co">#&gt; # A tibble: 6 x 2</span></a>
<a class="sourceLine" id="cb3-129" title="129"><span class="co">#&gt;   PMCID      text              </span></a>
<a class="sourceLine" id="cb3-130" title="130"><span class="co">#&gt;   &lt;chr&gt;      &lt;list&gt;            </span></a>
<a class="sourceLine" id="cb3-131" title="131"><span class="co">#&gt; 1 PMC6302599 &lt;tibble [169 x 4]&gt;</span></a>
<a class="sourceLine" id="cb3-132" title="132"><span class="co">#&gt; 2 PMC6302597 &lt;tibble [87 x 4]&gt; </span></a>
<a class="sourceLine" id="cb3-133" title="133"><span class="co">#&gt; 3 PMC6302590 &lt;tibble [141 x 4]&gt;</span></a>
<a class="sourceLine" id="cb3-134" title="134"><span class="co">#&gt; 4 PMC6302578 &lt;tibble [64 x 4]&gt; </span></a>
<a class="sourceLine" id="cb3-135" title="135"><span class="co">#&gt; 5 PMC6302575 &lt;tibble [55 x 4]&gt; </span></a>
<a class="sourceLine" id="cb3-136" title="136"><span class="co">#&gt; 6 PMC6302572 &lt;tibble [151 x 4]&gt;</span></a></code></pre></div>
<p>If we look at each of these embedded tibbles, we can see they contain the full text. Let’s just take a look at the first one. This will give us the text we’re pulling out of the first XML.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">my_text <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">unnest</span>(text) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="st">  </span><span class="kw">select</span>(text) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="st">  </span><span class="kw">head</span>()</a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">#&gt; # A tibble: 6 x 1</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">#&gt;   text                                                                          </span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">#&gt;   &lt;chr&gt;                                                                         </span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">#&gt; 1 Multiple Introductions of Domestic Cat Feline Leukemia Virus in Endangered Fl~</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">#&gt; 2 The endangered Florida panther (Puma concolor coryi) had an outbreak of infec~</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">#&gt; 3 A vaccination campaign was instituted during 2003-2007 and no additional case~</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">#&gt; 4 During 2010-2016, six additional FeLV cases were documented.                  </span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">#&gt; 5 We characterized FeLV genomes isolated from Florida panthers from both outbre~</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co">#&gt; 6 Phylogenetic analyses identified at least 2 circulating FeLV strains in panth~</span></a></code></pre></div>
<p>Now we can use the <code>generate_features</code> function to get the numerical embeddings of the documents. Here, for example, I will specify that we want to perform stemming on the text data and embed the data using 50 topic model LDA features.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">my_features &lt;-</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="st">  </span><span class="kw">generate_features</span>(my_text, <span class="dt">lem_stem =</span> <span class="st">&quot;stem&quot;</span>, <span class="dt">mode =</span> <span class="st">&quot;tm 50&quot;</span>)</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#&gt; INFO  [01:19:48.668] early stopping at 100 iteration </span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#&gt; INFO  [01:19:49.900] early stopping at 50 iteration</span></a>
<a class="sourceLine" id="cb5-5" title="5"></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="kw">dim</span>(my_features)</a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co">#&gt; [1] 94 50</span></a></code></pre></div>
<p>There’s also the option to preprocess the input features.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">my_features_processed &lt;-</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="st">  </span><span class="kw">preprocess_text</span>(my_features, <span class="dt">mode =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;tm&quot;</span>)</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">#&gt; [1] &quot;Normalizing a dense matrix&quot;</span></a></code></pre></div>
<p>We can now use these features as inputs to our model. However, since the primary task is classification (classifying text documents by their data sharing practices), we need labels. These labels will help us train and test our supervised model. The labels come from pulling data sharing information using text mining. Let’s walk through the pipeline to do that.</p>
<p>We already have the document IDs that we’d like to look at. Now instead of pulling the full text information, we can just pull the data sharing information using <code>get_DAS</code> and purrr. We can get a dataframe with embedded data sharing information.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">my_das &lt;-</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="st">  </span>my_ids <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb7-4" title="4">    <span class="dt">das =</span> purrr<span class="op">::</span><span class="kw">map</span>(PMCID, get_DAS)</a>
<a class="sourceLine" id="cb7-5" title="5">  )</a>
<a class="sourceLine" id="cb7-6" title="6"></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="kw">head</span>(my_das)</a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">#&gt; # A tibble: 6 x 2</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">#&gt;   PMCID      das             </span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co">#&gt;   &lt;chr&gt;      &lt;list&gt;          </span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="co">#&gt; 1 PMC6302599 &lt;tibble [1 x 2]&gt;</span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="co">#&gt; 2 PMC6302597 &lt;chr [1]&gt;       </span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co">#&gt; 3 PMC6302590 &lt;tibble [1 x 2]&gt;</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co">#&gt; 4 PMC6302578 &lt;chr [1]&gt;       </span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="co">#&gt; 5 PMC6302575 &lt;tibble [1 x 2]&gt;</span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="co">#&gt; 6 PMC6302572 &lt;chr [1]&gt;</span></a></code></pre></div>
<p>We also have functions in our toolbox to handle this DAS data. First we have the <code>clean_DAS</code> function to parse the data we pulled using <code>get_DAS</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">my_das_cleaned &lt;-</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="st">  </span><span class="kw">clean_DAS</span>(my_das)</a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="kw">head</span>(my_das_cleaned)</a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co">#&gt; # A tibble: 6 x 5</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="co">#&gt;   PMCID   has_das tagging_method    content                       attached_media</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="co">#&gt;   &lt;chr&gt;   &lt;lgl&gt;   &lt;chr&gt;             &lt;chr&gt;                         &lt;chr&gt;         </span></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="co">#&gt; 1 PMC630~ TRUE    Supplementary Ma~ Appendix Additional informat~ pdf           </span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="co">#&gt; 2 PMC630~ FALSE   &lt;NA&gt;              &lt;NA&gt;                          &lt;NA&gt;          </span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="co">#&gt; 3 PMC630~ TRUE    Supplementary Ma~ Appendix Additional details ~ pdf           </span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="co">#&gt; 4 PMC630~ FALSE   &lt;NA&gt;              &lt;NA&gt;                          &lt;NA&gt;          </span></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="co">#&gt; 5 PMC630~ TRUE    Supplementary Ma~ Appendix Evolutionary relati~ pdf           </span></a>
<a class="sourceLine" id="cb8-13" title="13"><span class="co">#&gt; 6 PMC630~ FALSE   &lt;NA&gt;              &lt;NA&gt;                          &lt;NA&gt;</span></a></code></pre></div>
<p>Now we can label our data sharing methods to use in our classification task as labels. The current labeling scheme is: 0) No data sharing information. 1) Supplementary materials for download. 2) Data citation or link to repository. 3) Data upon request. 4) Restricted access. 5) Supplementary materials, but no downloadable file. 6) Other.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">my_labels &lt;-</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="st">  </span><span class="kw">label_DAS</span>(my_das_cleaned)</a>
<a class="sourceLine" id="cb9-3" title="3"></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="kw">head</span>(my_labels)</a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co">#&gt; # A tibble: 6 x 2</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="co">#&gt;   PMCID      label</span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="co">#&gt;   &lt;chr&gt;      &lt;int&gt;</span></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="co">#&gt; 1 PMC6302599     1</span></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="co">#&gt; 2 PMC6302597     0</span></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="co">#&gt; 3 PMC6302590     1</span></a>
<a class="sourceLine" id="cb9-11" title="11"><span class="co">#&gt; 4 PMC6302578     0</span></a>
<a class="sourceLine" id="cb9-12" title="12"><span class="co">#&gt; 5 PMC6302575     1</span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="co">#&gt; 6 PMC6302572     0</span></a></code></pre></div>
<p>Now we can merge our inputs and outputs, to get one single matrix. We also need to make sure our labels are type factor (can do this by <code>factor(label)</code> as shown below).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">my_data &lt;-</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="st">  </span><span class="kw">bind_cols</span>(my_labels, <span class="kw">as_tibble</span>(my_features_processed)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>PMCID) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb10-5" title="5">    <span class="dt">label =</span> <span class="kw">factor</span>(label)</a>
<a class="sourceLine" id="cb10-6" title="6">  )</a>
<a class="sourceLine" id="cb10-7" title="7"><span class="co">#&gt; Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="co">#&gt; Using compatibility `.name_repair`.</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="co">#&gt; This warning is displayed once every 8 hours.</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="co">#&gt; Call `lifecycle::last_warnings()` to see where this warning was generated.</span></a>
<a class="sourceLine" id="cb10-11" title="11"></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="kw">head</span>(my_data)</a>
<a class="sourceLine" id="cb10-13" title="13"><span class="co">#&gt; # A tibble: 6 x 51</span></a>
<a class="sourceLine" id="cb10-14" title="14"><span class="co">#&gt;   label      V1      V2       V3      V4      V5      V6      V7      V8      V9</span></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="co">#&gt;   &lt;fct&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="co">#&gt; 1 1     -0.0377 -0.0332 -0.0215  -0.0377 -0.0376 -0.0354 -0.0258 -0.0377 -0.0377</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="co">#&gt; 2 0     -0.0762 -0.0704  0.495   -0.0756 -0.0600  0.408  -0.0756 -0.0762 -0.0762</span></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="co">#&gt; 3 1     -0.0392  0.0216  0.0685  -0.0268 -0.0392 -0.0349 -0.0392 -0.0106 -0.0392</span></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="co">#&gt; 4 0     -0.0628 -0.0647 -0.00217 -0.0647 -0.0647 -0.0647 -0.0647 -0.0647 -0.0647</span></a>
<a class="sourceLine" id="cb10-20" title="20"><span class="co">#&gt; 5 1     -0.0461 -0.0457  0.0749  -0.0457 -0.0461 -0.0461 -0.0461 -0.0461 -0.0461</span></a>
<a class="sourceLine" id="cb10-21" title="21"><span class="co">#&gt; 6 0     -0.0422 -0.0285 -0.00314 -0.0422 -0.0422  0.0595 -0.0422 -0.0422 -0.0422</span></a>
<a class="sourceLine" id="cb10-22" title="22"><span class="co">#&gt; # ... with 41 more variables: V10 &lt;dbl&gt;, V11 &lt;dbl&gt;, V12 &lt;dbl&gt;, V13 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb10-23" title="23"><span class="co">#&gt; #   V14 &lt;dbl&gt;, V15 &lt;dbl&gt;, V16 &lt;dbl&gt;, V17 &lt;dbl&gt;, V18 &lt;dbl&gt;, V19 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb10-24" title="24"><span class="co">#&gt; #   V20 &lt;dbl&gt;, V21 &lt;dbl&gt;, V22 &lt;dbl&gt;, V23 &lt;dbl&gt;, V24 &lt;dbl&gt;, V25 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb10-25" title="25"><span class="co">#&gt; #   V26 &lt;dbl&gt;, V27 &lt;dbl&gt;, V28 &lt;dbl&gt;, V29 &lt;dbl&gt;, V30 &lt;dbl&gt;, V31 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb10-26" title="26"><span class="co">#&gt; #   V32 &lt;dbl&gt;, V33 &lt;dbl&gt;, V34 &lt;dbl&gt;, V35 &lt;dbl&gt;, V36 &lt;dbl&gt;, V37 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb10-27" title="27"><span class="co">#&gt; #   V38 &lt;dbl&gt;, V39 &lt;dbl&gt;, V40 &lt;dbl&gt;, V41 &lt;dbl&gt;, V42 &lt;dbl&gt;, V43 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb10-28" title="28"><span class="co">#&gt; #   V44 &lt;dbl&gt;, V45 &lt;dbl&gt;, V46 &lt;dbl&gt;, V47 &lt;dbl&gt;, V48 &lt;dbl&gt;, V49 &lt;dbl&gt;, V50 &lt;dbl&gt;</span></a></code></pre></div>
<p>Since we are using this dataset in a model, we need to split our dataset into training and testing datasets. Shown below is an 80/20 train/test split (set <code>p = 0.8</code>).</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">train_index &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="st">  </span>caret<span class="op">::</span><span class="kw">createDataPartition</span>(</a>
<a class="sourceLine" id="cb11-3" title="3">    my_data<span class="op">$</span>label, </a>
<a class="sourceLine" id="cb11-4" title="4">    <span class="dt">p =</span> <span class="fl">0.8</span>, </a>
<a class="sourceLine" id="cb11-5" title="5">    <span class="dt">list =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb11-6" title="6">    <span class="dt">times =</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb11-7" title="7">  )</a>
<a class="sourceLine" id="cb11-8" title="8"></a>
<a class="sourceLine" id="cb11-9" title="9">train_data &lt;-<span class="st"> </span>my_data[train_index,]</a>
<a class="sourceLine" id="cb11-10" title="10"><span class="co">#&gt; Warning: The `i` argument of ``[`()` can&#39;t be a matrix as of tibble 3.0.0.</span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="co">#&gt; Convert to a vector.</span></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="co">#&gt; This warning is displayed once every 8 hours.</span></a>
<a class="sourceLine" id="cb11-13" title="13"><span class="co">#&gt; Call `lifecycle::last_warnings()` to see where this warning was generated.</span></a>
<a class="sourceLine" id="cb11-14" title="14">test_data &lt;-<span class="st"> </span>my_data[<span class="op">-</span>train_index,]</a></code></pre></div>
<p>Many times, our dataset has imbalanced labels. We can handle this using undersampling, oversampling, or synthetic data generation. We want to do sampling after splitting into train and test so the resampling doesn’t bleed into the splitting.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">train_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="st">  </span><span class="kw">count</span>(label)</a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co">#&gt; # A tibble: 7 x 2</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co">#&gt;   label     n</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="co">#&gt;   &lt;fct&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="co">#&gt; 1 0        26</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="co">#&gt; 2 1        30</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co">#&gt; 3 2         4</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#&gt; 4 3         6</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">#&gt; 5 4         6</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="co">#&gt; 6 5         3</span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="co">#&gt; 7 6         4</span></a></code></pre></div>
<p>The best way I’ve found to do this is to use ROSE (Random Over-Sampling Examples). Following our imbalanced class of 7 different labels (0 through 6) with heavily represented groups 0 and 1, there’s a function called <code>balanced_labels</code>. For a dataset with a different label breakdown, check out the <code>ROSE</code> documentation on CRAN.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">balanced_train_data &lt;-</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="st">  </span>train_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="st">  </span><span class="kw">balance_labels</span>(<span class="dt">p =</span> <span class="fl">0.87</span>)</a>
<a class="sourceLine" id="cb13-4" title="4"></a>
<a class="sourceLine" id="cb13-5" title="5">balanced_train_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="st">  </span><span class="kw">count</span>(label)</a>
<a class="sourceLine" id="cb13-7" title="7"><span class="co">#&gt; # A tibble: 7 x 2</span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="co">#&gt;   label     n</span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="co">#&gt;   &lt;fct&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="co">#&gt; 1 0        25</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="co">#&gt; 2 1        30</span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="co">#&gt; 3 2        25</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="co">#&gt; 4 3        27</span></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="co">#&gt; 5 4        27</span></a>
<a class="sourceLine" id="cb13-15" title="15"><span class="co">#&gt; 6 5        24</span></a>
<a class="sourceLine" id="cb13-16" title="16"><span class="co">#&gt; 7 6        25</span></a></code></pre></div>
<p>Now our dataset is more balanced and we are ready to use this dataset in a model. Check out the model zoo to see how we can use a dataset to train and test a model.To use the datasets in the model zoo, save the datasets by <code>write_rds(balanced_train_data, &quot;./path_to_file.rds&quot;)</code>.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
